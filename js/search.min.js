const summaryInclude=92;let fuseOptions={shouldSort:!0,includeMatches:!0,tokenize:!0,matchAllTokens:!0,threshold:0,location:0,distance:100,maxPatternLength:64,minMatchCharLength:3,keys:[{name:"title",weight:.9},{name:"tags",weight:.6},{name:"contents",weight:.4}]},searchInput=document.getElementById("search-query");function getUrlParameter(e){e=e.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");let n=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=n.exec(location.search);return t===null?"":decodeURIComponent(t[1].replace(/\+/g," "))}let searchQuery=getUrlParameter("q").trim();searchQuery?(document.getElementById("search-query").value=searchQuery,executeSearch(searchQuery)):document.getElementById("search-results").innerHTML="";async function moreLoad(e){let o=document.querySelector("main"),t=o.getElementsByTagName("article"),n=t.length,s=document.querySelector(".next_page");for(i=e;i<n;i++)i<e+5?t[i].style.display="block":t[i].style.display="none";e<n-5?e+=5:s.innerHTML="끝",text=`moreLoad(0)`.replace("0",e),s.setAttribute("onclick",text)}function executeSearch(e){fetch("index.json").then(function(e){return e.json()}).then(function(t){let s=new Fuse(t,fuseOptions),n=s.search(e);if(n.length>0){if(populateResults(n),n.length>4){let e=document.createElement("button");e.classList.add("next_page"),e.innerHTML=`더 보기`,e.setAttribute("onclick",`moreLoad(4)`),document.getElementById("search-results").appendChild(e),moreLoad(0)}}else searchInput.value=null,searchInput.placeholder="검색 결과가 없습니다.",searchInput.focus()})}function populateResults(e){e.forEach(function(t,n){let o=t.item.contents,r="",d=[];if(d.push(searchQuery),r.length<1){var i,a,c,l,f,v=new RegExp(`[^.?!]*(?<=[.?\\s!])${searchQuery}(?=[\\s.?!])[^.?!]*[.?!]`,"i"),m=summaryInclude*2,u=o.toLowerCase().indexOf(searchQuery.toLowerCase()),p=o.indexOf(v.exec(o)),g=!1;p+m<u?(c=u,g=!0):c=p,i=c+m,i>o.length&&(i=o.length),g?(i-=3,r+="…"+o.substring(c,i).trim()):r+=o.substring(c,i).trim()}r+="…",l=document.createElement("textarea"),l.innerHTML=r,f=l.value;let s=document.getElementById("search-result-template").content.cloneNode(!0);s.querySelector(".result").setAttribute("id","summary-"+n),s.querySelector(".search_title").textContent=t.item.title,s.querySelector(".search_title").setAttribute("href",t.item.permalink),s.querySelector(".date").textContent=t.item.date,s.querySelector(".excerpt").textContent=f;let h=t.item.tags;h?(a=h.toString().split(","),a.forEach(function(e,t){a[t]="<li><a href=https://nasoru.com/tags/"+a[t]+">"+a[t]+"</a></li>"}),s.querySelector(".search_tags").innerHTML=a.toString().replaceAll(",","")):s.querySelector(".search_iftags").remove(),d.forEach(function(e){let n=new Mark(s);n.mark(e)}),document.getElementById("search-results").appendChild(s),searchInput.value=null,searchInput.placeholder='"'+d[0]+'" '+e.length+"건의 검색 결과가 있습니다.",searchInput.focus()})}